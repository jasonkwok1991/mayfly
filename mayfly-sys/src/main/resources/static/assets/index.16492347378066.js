var fe=Object.defineProperty,be=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var oe=(e,l,s)=>l in e?fe(e,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[l]=s,q=(e,l)=>{for(var s in l||(l={}))ge.call(l,s)&&oe(e,s,l[s]);if(ne)for(var s of ne(l))ye.call(l,s)&&oe(e,s,l[s]);return e},W=(e,l)=>be(e,he(l));import{y as P,r as X,a as K,F as x,t as j,E as z,d as u,q as r,e as w,j as t,k as o,I as H,J,G as v,i as L,H as S,a4 as ue,h as F,V as ee,f as k,w as T,P as te,g as Q,M as ve,o as De}from"./vendor.1649234737806.js";import{_ as G,g as Fe,c as ae}from"./index.1649234737806.js";import{A as I}from"./Api.1649234737806.js";import{S as Ce}from"./SshTerminal.1649234737806.js";import{E as se}from"./Enum.1649234737806.js";import{n as le}from"./assert.1649234737806.js";import{c as re}from"./codemirror.1649234737806.js";const _e=P({name:"DynamicForm",props:{formInfo:{type:Object},formData:{type:[Object,Boolean]}},setup(e,l){const s=X(),y=K({form:{},submitDisabled:!1});x(e.formData,(h,b)=>{e.formData&&(y.form=q({},e.formData))});const $=()=>{s.value.validate(h=>{if(h){const b=q({},y.form),i=y.form.id?e.formInfo.updateApi:e.formInfo.createApi;i?(y.submitDisabled=!0,i.request(y.form).then(d=>{z.success("\u4FDD\u5B58\u6210\u529F"),l.emit("submitSuccess",b),y.submitDisabled=!1},d=>{y.submitDisabled=!1})):z.error("\u8868\u5355\u672A\u8BBE\u7F6E\u5BF9\u5E94\u7684\u63D0\u4EA4\u6743\u9650")}else return!1})},D=()=>{l.emit("reset"),p()},p=()=>{s.resetFields(),y.form={}};return W(q({},j(y)),{dynamicForm:s,submit:$,reset:D,resetFieldsAndData:p})}}),Ie={class:"dynamic-form"},ke={key:1},$e=F("\u91CD \u7F6E"),Ee=F("\u4FDD \u5B58");function we(e,l,s,y,$,D){const p=u("el-input"),h=u("el-option"),b=u("el-select"),i=u("el-form-item"),d=u("el-col"),c=u("el-row"),C=u("el-button"),B=u("el-form");return r(),w("div",Ie,[t(B,{model:e.form,ref:"dynamicForm","label-width":e.formInfo.labelWidth?e.formInfo.labelWidth:"100px",size:e.formInfo.size?e.formInfo.size:""},{default:o(()=>[(r(!0),w(H,null,J(e.formInfo.formRows,E=>(r(),v(c,{key:E.key,class:"mt15"},{default:o(()=>[(r(!0),w(H,null,J(E,a=>(r(),v(d,{key:a.key,span:a.span?a.span:24/E.length},{default:o(()=>[t(i,{prop:a.name,label:a.label,"label-width":a.labelWidth,required:a.required,rules:a.rules},{default:o(()=>[a.type==="input"?(r(),v(p,{key:0,modelValue:e.form[a.name],"onUpdate:modelValue":n=>e.form[a.name]=n,modelModifiers:{trim:!0},placeholder:a.placeholder,type:a.inputType,clearable:"",onChange:n=>a.change?a.change(e.form):""},null,8,["modelValue","onUpdate:modelValue","placeholder","type","onChange"])):a.type==="text"?(r(),w("span",ke,L(e.form[a.name]),1)):a.type==="select"?(r(),v(b,{key:2,modelValue:e.form[a.name],"onUpdate:modelValue":n=>e.form[a.name]=n,modelModifiers:{trim:!0},placeholder:a.placeholder,filterable:a.filterable,remote:a.remote,"remote-method":a.remoteMethod,onFocus:n=>a.focus?a.focus(e.form):"",clearable:"",disabled:a.updateDisabled&&e.form.id!=null,style:{width:"100%"}},{default:o(()=>[(r(!0),w(H,null,J(a.options,n=>(r(),v(h,{key:n.key,label:n[a.optionProps&&a.optionProps.label||"label"],value:n[a.optionProps&&a.optionProps.value||"value"]},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","filterable","remote","remote-method","onFocus","disabled"])):S("",!0)]),_:2},1032,["prop","label","label-width","required","rules"])]),_:2},1032,["span"]))),128))]),_:2},1024))),128)),t(c,{type:"flex",justify:"center",class:"mt5"},{default:o(()=>[ue(e.$slots,"btns",{submitDisabled:e.submitDisabled,data:e.form,submit:e.submit},()=>[t(C,{onClick:e.reset},{default:o(()=>[$e]),_:1},8,["onClick"]),t(C,{type:"primary",onClick:e.submit},{default:o(()=>[Ee]),_:1},8,["onClick"])])]),_:3})]),_:3},8,["model","label-width","size"])])}var Be=G(_e,[["render",we]]);const Ve=P({name:"DynamicFormDialog",components:{DynamicForm:Be},props:{visible:{type:Boolean},dialogWidth:{type:String},title:{type:String},formInfo:{type:Object},formData:{type:[Object,Boolean]}},setup(e,l){const s=X(),y=()=>{l.emit("update:visible",!1),l.emit("update:formData",null),l.emit("close"),setTimeout(()=>{s.resetFieldsAndData()},200)};return{df:s,close:y,submitSuccess:D=>{l.emit("submitSuccess",D),y()}}}}),Se={class:"form-dialog"},Ae=F("\u4FDD \u5B58"),Te=F("\u53D6 \u6D88");function Ue(e,l,s,y,$,D){const p=u("el-button"),h=u("dynamic-form"),b=u("el-dialog");return r(),w("div",Se,[t(b,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[1]||(l[1]=i=>e.visible=i),width:e.dialogWidth?e.dialogWidth:"500px"},{default:o(()=>[t(h,{ref:"df","form-info":e.formInfo,"form-data":e.formData,onSubmitSuccess:e.submitSuccess},{btns:o(i=>[ue(e.$slots,"btns",{class:"mt5"},()=>[t(p,{disabled:i.submitDisabled,type:"primary",onClick:i.submit},{default:o(()=>[Ae]),_:2},1032,["disabled","onClick"]),t(p,{disabled:i.submitDisabled,onClick:l[0]||(l[0]=d=>e.close())},{default:o(()=>[Te]),_:2},1032,["disabled"])])]),_:3},8,["form-info","form-data","onSubmitSuccess"])]),_:3},8,["title","modelValue","width"])])}var ze=G(Ve,[["render",Ue]]);const A={list:I.create("/machines","get"),info:I.create("/machines/{id}/sysinfo","get"),top:I.create("/machines/{id}/top","get"),save:I.create("/machines","post"),del:I.create("/machines/{id}","delete"),scripts:I.create("/machines/{machineId}/scripts","get"),runScript:I.create("/machines/{machineId}/scripts/{scriptId}/run","get"),saveScript:I.create("/machines/{machineId}/scripts","post"),deleteScript:I.create("/machines/{machineId}/scripts/{scriptId}","delete"),files:I.create("/machines/{id}/files","get"),lsFile:I.create("/machines/{machineId}/files/{fileId}/read-dir","get"),rmFile:I.create("/machines/{machineId}/files/{fileId}/rm","delete"),uploadFile:I.create("/machines/files/upload","post"),fileContent:I.create("/machines/{machineId}/files/{fileId}/read","get"),updateFileContent:I.create("/machines/{machineId}/files/{id}/write","post"),addConf:I.create("/machines/{machineId}/files","post"),delConf:I.create("/machines/{machineId}/files/{id}","delete"),terminal:I.create("/api/machines/{id}/terminal","get")};var O={scriptTypeEnum:new se().add("RESULT","\u6709\u7ED3\u679C",1).add("NO_RESULT","\u65E0\u7ED3\u679C",2).add("REAL_TIME","\u5B9E\u65F6\u4EA4\u4E92",3),FileTypeEnum:new se().add("DIRECTORY","\u76EE\u5F55",1).add("FILE","\u6587\u4EF6",2)};const Me=P({name:"ScriptEdit",components:{codemirror:re},props:{visible:{type:Boolean},data:{type:Object},title:{type:String},machineId:{type:Number},isCommon:{type:Boolean}},setup(e,{emit:l}){const{isCommon:s,machineId:y}=j(e),$=X(null),D=K({visible:!1,submitDisabled:!1,form:{id:null,name:"",machineId:0,description:"",script:"",type:null},btnLoading:!1});x(e,(b,i)=>{b.data?D.form=q({},b.data):(D.form={},D.form.script=""),D.visible=b.visible});const p=()=>{D.form.machineId=s?9999999:y,$.value.validate(b=>{if(b)le(D.form.name,"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"),le(D.form.description,"\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),le(D.form.script,"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),A.saveScript.request(D.form).then(i=>{z.success("\u4FDD\u5B58\u6210\u529F"),l("submitSuccess"),D.submitDisabled=!1,h()},i=>{D.submitDisabled=!1});else return!1})},h=()=>{l("update:visible",!1),l("cancel")};return W(q({},j(D)),{enums:O,mockDataForm:$,btnOk:p,cancel:h})}}),qe={class:"mock-data-dialog"},Ne={class:"dialog-footer"},Le=F("\u4FDD \u5B58"),Re=F("\u5173 \u95ED");function We(e,l,s,y,$,D){const p=u("el-input"),h=u("el-form-item"),b=u("el-option"),i=u("el-select"),d=u("codemirror"),c=u("el-form"),C=u("el-button"),B=u("el-dialog"),E=ee("auth");return r(),w("div",qe,[t(B,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[5]||(l[5]=a=>e.visible=a),"close-on-click-modal":!1,"before-close":e.cancel,"show-close":!0,"destroy-on-close":!0,width:"800px"},{footer:o(()=>[k("div",Ne,[T((r(),v(C,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"small",disabled:e.submitDisabled},{default:o(()=>[Le]),_:1},8,["loading","onClick","disabled"])),[[E,"machine:script:save"]]),t(C,{onClick:l[4]||(l[4]=a=>e.cancel()),disabled:e.submitDisabled,size:"small"},{default:o(()=>[Re]),_:1},8,["disabled"])])]),default:o(()=>[t(c,{model:e.form,ref:"mockDataForm","label-width":"70px",size:"small"},{default:o(()=>[t(h,{prop:"method",label:"\u540D\u79F0"},{default:o(()=>[t(p,{modelValue:e.form.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.form.name=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(h,{prop:"description",label:"\u63CF\u8FF0"},{default:o(()=>[t(p,{modelValue:e.form.description,"onUpdate:modelValue":l[1]||(l[1]=a=>e.form.description=a),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),t(h,{prop:"type",label:"\u7C7B\u578B"},{default:o(()=>[t(i,{modelValue:e.form.type,"onUpdate:modelValue":l[2]||(l[2]=a=>e.form.type=a),"default-first-option":"",style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B"},{default:o(()=>[(r(!0),w(H,null,J(e.enums.scriptTypeEnum,a=>(r(),v(b,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{prop:"script",label:"\u5185\u5BB9",id:"content"},{default:o(()=>[t(d,{ref:"cmEditor",modelValue:e.form.script,"onUpdate:modelValue":l[3]||(l[3]=a=>e.form.script=a),language:"shell"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}var Oe=G(Me,[["render",We]]);const je=P({name:"ServiceManage",components:{ScriptEdit:Oe,SshTerminal:Ce},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,l){const s=K({visible:!1,type:0,currentId:null,currentData:null,editDialog:{visible:!1,data:null,title:"",machineId:9999999},scriptTable:[],resultDialog:{visible:!1,result:""},terminalDialog:{visible:!1,cmd:"",machineId:0}});x(e,(c,C)=>{e.machineId&&y(),s.visible=c.visible});const y=async()=>{s.currentId=null,s.currentData=null;const c=s.type==0?e.machineId:9999999,C=await A.scripts.request({machineId:c});s.scriptTable=C.list},$=async c=>{const C=c.type==O.scriptTypeEnum.NO_RESULT.value;if(c.type==O.scriptTypeEnum.RESULT.value||C){const B=await A.runScript.request({machineId:e.machineId,scriptId:c.id});if(C){z.success("\u6267\u884C\u5B8C\u6210");return}s.resultDialog.result=B,s.resultDialog.visible=!0;return}if(c.type==O.scriptTypeEnum.REAL_TIME.value){s.terminalDialog.cmd=c.script,s.terminalDialog.visible=!0,s.terminalDialog.machineId=e.machineId;return}},D=()=>{s.terminalDialog.visible=!1,s.terminalDialog.machineId=0},p=c=>{!c||(s.currentId=c.id,s.currentData=c)},h=c=>{s.editDialog.machineId=e.machineId,s.editDialog.data=c,c?s.editDialog.title="\u67E5\u770B\u7F16\u8F91\u811A\u672C":s.editDialog.title="\u65B0\u589E\u811A\u672C",s.editDialog.visible=!0},b=()=>{y()},i=c=>{te.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${c.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{A.deleteScript.request({machineId:e.machineId,scriptId:c.id}).then(C=>{y()})})},d=()=>{l.emit("update:visible",!1),l.emit("update:machineId",null),l.emit("cancel"),s.scriptTable=[]};return W(q({},j(s)),{enums:O,getScripts:y,runScript:$,closeTermnial:D,choose:p,editScript:h,submitSuccess:b,deleteRow:i,handleClose:d})}}),Pe={class:"file-manage"},Ge={class:"toolbar"},Ye={style:{float:"left"}},He={style:{float:"right"}},Je=F("\u67E5\u770B"),Ke=F("\u6DFB\u52A0"),Ze=F("\u5220\u9664"),Qe=k("i",null,null,-1),Xe=F("\u786E\u5B9A"),xe=F("\u6267\u884C"),el={style:{"white-space":"pre-line",padding:"10px",color:"#000000"}};function ll(e,l,s,y,$,D){const p=u("el-option"),h=u("el-select"),b=u("el-button"),i=u("el-radio"),d=u("el-table-column"),c=u("el-table"),C=u("el-dialog"),B=u("ssh-terminal"),E=u("script-edit"),a=ee("auth");return r(),w("div",Pe,[t(C,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[5]||(l[5]=n=>e.visible=n),"destroy-on-close":!0,"show-close":!0,"before-close":e.handleClose,width:"60%"},{default:o(()=>[k("div",Ge,[k("div",Ye,[t(h,{modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=n=>e.type=n),onChange:e.getScripts,size:"small",placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(r(),v(p,{key:0,label:"\u79C1\u6709",value:0})),(r(),v(p,{key:1,label:"\u516C\u5171",value:1}))]),_:1},8,["modelValue","onChange"])]),k("div",He,[t(b,{onClick:l[1]||(l[1]=n=>e.editScript(e.currentData)),disabled:e.currentId==null,type:"primary",icon:"el-icon-tickets",size:"small",plain:""},{default:o(()=>[Je]),_:1},8,["disabled"]),T((r(),v(b,{type:"primary",onClick:l[2]||(l[2]=n=>e.editScript(null)),icon:"el-icon-plus",size:"small",plain:""},{default:o(()=>[Ke]),_:1})),[[a,"machine:script:save"]]),t(b,{disabled:e.currentId==null,type:"danger",onClick:l[3]||(l[3]=n=>e.deleteRow(e.currentData)),icon:"el-icon-delete",size:"small",plain:""},{default:o(()=>[Ze]),_:1},8,["disabled"])])]),t(c,{data:e.scriptTable,onCurrentChange:e.choose,stripe:"",border:"",size:"small",style:{width:"100%"}},{default:o(()=>[t(d,{label:"\u9009\u62E9",width:"55px"},{default:o(n=>[t(i,{modelValue:e.currentId,"onUpdate:modelValue":l[4]||(l[4]=U=>e.currentId=U),label:n.row.id},{default:o(()=>[Qe]),_:2},1032,["modelValue","label"])]),_:1}),t(d,{prop:"name",label:"\u540D\u79F0","min-width":50}),t(d,{prop:"description",label:"\u63CF\u8FF0","min-width":100,"show-overflow-tooltip":""}),t(d,{prop:"name",label:"\u7C7B\u578B","min-width":50},{default:o(n=>[F(L(e.enums.scriptTypeEnum.getLabelByValue(n.row.type)),1)]),_:1}),t(d,{label:"\u64CD\u4F5C"},{default:o(n=>[n.row.id==null?(r(),v(b,{key:0,onClick:U=>e.addFiles(n.row),type:"success",icon:"el-icon-success",size:"small",plain:""},{default:o(()=>[Xe]),_:2},1032,["onClick"])):S("",!0),n.row.id!=null?T((r(),v(b,{key:1,onClick:U=>e.runScript(n.row),type:"primary",icon:"el-icon-tickets",size:"small",plain:""},{default:o(()=>[xe]),_:2},1032,["onClick"])),[[a,"machine:script:run"]]):S("",!0)]),_:1})]),_:1},8,["data","onCurrentChange"])]),_:1},8,["title","modelValue","before-close"]),t(C,{title:"\u6267\u884C\u7ED3\u679C",modelValue:e.resultDialog.visible,"onUpdate:modelValue":l[6]||(l[6]=n=>e.resultDialog.visible=n),width:"40%"},{default:o(()=>[k("div",el,L(e.resultDialog.result),1)]),_:1},8,["modelValue"]),e.terminalDialog.visible?(r(),v(C,{key:0,title:"\u7EC8\u7AEF",modelValue:e.terminalDialog.visible,"onUpdate:modelValue":l[7]||(l[7]=n=>e.terminalDialog.visible=n),width:"70%","close-on-click-modal":!1,modal:!1,onClose:e.closeTermnial},{default:o(()=>[t(B,{ref:"terminal",cmd:e.terminalDialog.cmd,machineId:e.terminalDialog.machineId,height:"600px"},null,8,["cmd","machineId"])]),_:1},8,["modelValue","onClose"])):S("",!0),t(E,{visible:e.editDialog.visible,"onUpdate:visible":l[8]||(l[8]=n=>e.editDialog.visible=n),data:e.editDialog.data,"onUpdate:data":l[9]||(l[9]=n=>e.editDialog.data=n),title:e.editDialog.title,machineId:e.editDialog.machineId,"onUpdate:machineId":l[10]||(l[10]=n=>e.editDialog.machineId=n),isCommon:e.type==1,onSubmitSuccess:e.submitSuccess},null,8,["visible","data","title","machineId","isCommon","onSubmitSuccess"])])}var tl=G(je,[["render",ll]]);const il=P({name:"FileManage",components:{codemirror:re},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,{emit:l}){const s=A.addConf,y=A.delConf,$=A.updateFileContent,D=A.files,p=X(null),h=Fe("token"),b={tabSize:2,mode:"text/x-sh",theme:"panda-syntax",line:!0,lint:!0,gutters:["CodeMirror-lint-markers"],indentWithTabs:!0,smartIndent:!0,matchBrackets:!0,autofocus:!0,styleSelectedText:!0,styleActiveLine:!0,foldGutter:!0,hintOptions:{completeSingle:!0}},i=K({dialogVisible:!1,form:{id:null,type:null,name:"",remark:""},fileTable:[],btnLoading:!1,fileContent:{fileId:0,content:"",contentVisible:!1,dialogTitle:"",path:"",type:"shell"},tree:{title:"",visible:!1,folder:{id:0},node:{childNodes:[]},resolve:{}},props:{label:"name",children:"zones",isLeaf:"leaf"}});x(e,m=>{m.machineId&&d(),i.dialogVisible=m.visible});const d=async()=>{const m=await D.request({id:e.machineId});i.fileTable=m},c=()=>{i.fileTable=[{}].concat(i.fileTable)},C=async m=>{m.machineId=e.machineId,await s.request(m),z.success("\u6DFB\u52A0\u6210\u529F"),d()},B=(m,_)=>{_.id?te.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${_.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{y.request({machineId:e.machineId,id:_.id}).then(()=>{i.fileTable.splice(m,1)})}):i.fileTable.splice(m,1)},E=m=>{if(m.type==1){i.tree.folder=m,i.tree.title=m.name,f(i.tree.node,i.tree.resolve),i.tree.visible=!0;return}a(m.id,m.path)},a=async(m,_)=>{const V=await A.fileContent.request({fileId:m,path:_,machineId:e.machineId});i.fileContent.content=V,i.fileContent.fileId=m,i.fileContent.dialogTitle=_,i.fileContent.path=_,i.fileContent.type=n(_),i.fileContent.contentVisible=!0},n=m=>m.endsWith(".sh")?"shell":m.endsWith("js")||m.endsWith("json")?"javascript":m.endsWith("Dockerfile")?"dockerfile":m.endsWith("nginx.conf")?"nginx":m.endsWith("yaml")||m.endsWith("yml")?"yaml":m.endsWith("xml")||m.endsWith("html")?"html":"text",U=async()=>{await $.request({content:i.fileContent.content,id:i.fileContent.fileId,path:i.fileContent.path,machineId:e.machineId}),z.success("\u4FEE\u6539\u6210\u529F"),i.fileContent.contentVisible=!1,i.fileContent.content=""},N=()=>{l("update:visible",!1),l("update:machineId",null),l("cancel"),i.fileTable=[],i.tree.folder={id:0}},f=async(m,_)=>{if(typeof _!="function")return;const V=i.tree.folder;if(m.level===0){i.tree.node=m,i.tree.resolve=_;const Y=V?V.path:"/";return _([{name:Y,type:"d",path:Y}])}let R;const M=m.data;!M||M.name==M.path?R=V.path:R=M.path;const ie=await A.lsFile.request({fileId:V.id,machineId:e.machineId,path:R});for(const Y of ie)Y.type!="d"&&(Y.leaf=!0);return _(ie)},g=(m,_)=>{const V=_.path;te.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${V}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{A.rmFile.request({fileId:i.tree.folder.id,path:V,machineId:e.machineId}).then(()=>{z.success("\u5220\u9664\u6210\u529F"),p.value.remove(m)})}).catch(()=>{})},Z=(m,_)=>{const V=document.createElement("a");V.setAttribute("href",`${ae.baseApiUrl}/machines/${e.machineId}/files/${i.tree.folder.id}/download?&path=${_.path}&token=${h}`),V.click()},de=()=>`${ae.baseApiUrl}/machines/files/upload?token=${h}`,me=m=>{m.code==200?z.success("\u6587\u4EF6\u4E0A\u4F20\u4E2D..."):z.error(m.msg)},ce=m=>{const _=m.path;return["/","//","/usr","/usr/","/usr/bin","/opt","/run","/etc","/proc","/var","/mnt","/boot","/dev","/home","/media","/root"].indexOf(_)!=-1},pe=m=>{const _=Number(m);if(m&&!isNaN(_)){const V=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];let R=0,M=_;if(_>=1024)for(;M>1024;)M=M/1024,R++;return`${M.toFixed(2)}${V[R]}`}return"-"};return W(q({},j(i)),{fileTree:p,enums:O,token:h,cmOptions:b,add:c,getFiles:d,addFiles:C,deleteRow:B,getConf:E,getFileContent:a,updateContent:U,handleClose:N,loadNode:f,deleteFile:g,downloadFile:Z,getUploadFile:de,uploadSuccess:me,dontOperate:ce,formatFileSize:pe})}}),nl={class:"file-manage"},ol={class:"toolbar"},al={style:{float:"right"}},sl=F("\u6DFB\u52A0"),ul=F("\u786E\u5B9A"),rl=F("\u67E5\u770B"),dl=F("\u5220\u9664"),ml={style:{height:"45vh",overflow:"auto"}},cl={class:"custom-tree-node"},pl={key:0},fl={key:1},bl={key:2},hl={style:{display:"inline-block",width:"430px"}},gl={key:0,style:{color:"#67c23a"}},yl={class:"dialog-footer"},vl=F("\u4FDD \u5B58"),Dl=F("\u5173 \u95ED");function Fl(e,l,s,y,$,D){const p=u("el-button"),h=u("el-input"),b=u("el-table-column"),i=u("el-option"),d=u("el-select"),c=u("el-table"),C=u("el-dialog"),B=u("SvgIcon"),E=u("el-link"),a=u("el-upload"),n=u("el-tree"),U=u("codemirror"),N=ee("auth");return r(),w("div",nl,[t(C,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":l[0]||(l[0]=f=>e.dialogVisible=f),"show-close":!0,"before-close":e.handleClose,width:"800px"},{default:o(()=>[k("div",ol,[k("div",al,[T((r(),v(p,{type:"primary",onClick:e.add,icon:"plus",size:"small",plain:""},{default:o(()=>[sl]),_:1},8,["onClick"])),[[N,"machine:file:add"]])])]),t(c,{data:e.fileTable,stripe:"",style:{width:"100%"}},{default:o(()=>[t(b,{prop:"name",label:"\u540D\u79F0",width:""},{default:o(f=>[t(h,{modelValue:f.row.name,"onUpdate:modelValue":g=>f.row.name=g,size:"small",disabled:f.row.id!=null,clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(b,{prop:"name",label:"\u7C7B\u578B","min-width":"50px"},{default:o(f=>[t(d,{disabled:f.row.id!=null,size:"small",modelValue:f.row.type,"onUpdate:modelValue":g=>f.row.type=g,style:{width:"100px"},placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(r(!0),w(H,null,J(e.enums.FileTypeEnum,g=>(r(),v(i,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),_:1}),t(b,{prop:"path",label:"\u8DEF\u5F84",width:""},{default:o(f=>[t(h,{modelValue:f.row.path,"onUpdate:modelValue":g=>f.row.path=g,disabled:f.row.id!=null,size:"small",clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(b,{label:"\u64CD\u4F5C",width:""},{default:o(f=>[f.row.id==null?(r(),v(p,{key:0,onClick:g=>e.addFiles(f.row),type:"success",icon:"success",size:"small",plain:""},{default:o(()=>[ul]),_:2},1032,["onClick"])):S("",!0),f.row.id!=null?(r(),v(p,{key:1,onClick:g=>e.getConf(f.row),type:"primary",icon:"tickets",size:"small",plain:""},{default:o(()=>[rl]),_:2},1032,["onClick"])):S("",!0),T((r(),v(p,{type:"danger",onClick:g=>e.deleteRow(f.$index,f.row),icon:"delete",size:"small",plain:""},{default:o(()=>[dl]),_:2},1032,["onClick"])),[[N,"machine:file:del"]])]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue","before-close"]),t(C,{title:e.tree.title,modelValue:e.tree.visible,"onUpdate:modelValue":l[2]||(l[2]=f=>e.tree.visible=f),"close-on-click-modal":!1,width:"680px"},{default:o(()=>[k("div",ml,[e.tree.visible?(r(),v(n,{key:0,ref:"fileTree",load:e.loadNode,props:e.props,lazy:"","node-key":"id","expand-on-click-node":!1},{default:o(({node:f,data:g})=>[k("span",cl,[g.type=="d"&&!f.expanded?(r(),w("span",pl,[t(B,{name:"folder"})])):S("",!0),g.type=="d"&&f.expanded?(r(),w("span",fl,[t(B,{name:"folder-opened"})])):S("",!0),g.type=="-"?(r(),w("span",bl,[t(B,{name:"document"})])):S("",!0),k("span",hl,[F(L(f.label)+" ",1),g.type=="-"?(r(),w("span",gl,"\xA0\xA0["+L(e.formatFileSize(g.size))+"]",1)):S("",!0)]),k("span",null,[g.type=="-"&&g.size<1*1024*1024?(r(),v(E,{key:0,onClick:Q(Z=>e.getFileContent(e.tree.folder.id,g.path),["prevent"]),type:"info",icon:"view",underline:!1},null,8,["onClick"])):S("",!0),t(a,{"on-success":e.uploadSuccess,headers:{token:e.token},data:{fileId:e.tree.folder.id,path:g.path,machineId:e.machineId},action:e.getUploadFile({path:g.path}),"show-file-list":!1,name:"file",multiple:"",limit:100,style:{display:"inline-block","margin-left":"2px"}},{default:o(()=>[g.type=="d"?T((r(),v(E,{key:0,onClick:l[1]||(l[1]=Q(()=>{},["prevent"])),icon:"upload",underline:!1},null,512)),[[N,"machine:file:upload"]]):S("",!0)]),_:2},1032,["on-success","headers","data","action"]),g.type=="-"?T((r(),v(E,{key:1,onClick:Q(Z=>e.downloadFile(f,g),["prevent"]),type:"danger",icon:"download",underline:!1,style:{"margin-left":"2px"}},null,8,["onClick"])),[[N,"machine:file:write"]]):S("",!0),e.dontOperate(g)?S("",!0):T((r(),v(E,{key:2,onClick:Q(Z=>e.deleteFile(f,g),["prevent"]),type:"danger",icon:"delete",underline:!1,style:{"margin-left":"2px"}},null,8,["onClick"])),[[N,"machine:file:rm"]])])])]),_:1},8,["load","props"])):S("",!0)])]),_:1},8,["title","modelValue"]),t(C,{"destroy-on-close":!0,title:e.fileContent.dialogTitle,modelValue:e.fileContent.contentVisible,"onUpdate:modelValue":l[5]||(l[5]=f=>e.fileContent.contentVisible=f),"close-on-click-modal":!1,top:"5vh",width:"70%"},{footer:o(()=>[k("div",yl,[T((r(),v(p,{type:"primary",onClick:e.updateContent,size:"small"},{default:o(()=>[vl]),_:1},8,["onClick"])),[[N,"machine:file:write"]]),t(p,{onClick:l[4]||(l[4]=f=>e.fileContent.contentVisible=!1),size:"small"},{default:o(()=>[Dl]),_:1})])]),default:o(()=>[k("div",null,[t(U,{"can-change-mode":!0,ref:"cmEditor",modelValue:e.fileContent.content,"onUpdate:modelValue":l[3]||(l[3]=f=>e.fileContent.content=f),language:e.fileContent.type},null,8,["modelValue","language"])])]),_:1},8,["title","modelValue"])])}var Cl=G(il,[["render",Fl]]);const _l=P({name:"MachineList",components:{ServiceManage:tl,FileManage:Cl,DynamicFormDialog:ze},setup(){const e=ve(),l=K({params:{pageNum:1,pageSize:10,host:null,clusterId:null},data:{list:[],total:10},currentId:null,currentData:null,infoDialog:{visible:!1,info:""},serviceDialog:{visible:!1,machineId:0,title:""},fileDialog:{visible:!1,machineId:0,title:""},monitorDialog:{visible:!1,machineId:0},formDialog:{visible:!1,title:"",formInfo:{createApi:A.save,updateApi:A.save,formRows:[[{type:"input",label:"\u540D\u79F0\uFF1A",name:"name",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur","change"]}]}],[{type:"input",label:"ip\uFF1A",name:"ip",placeholder:"\u8BF7\u8F93\u5165ip",rules:[{required:!0,message:"\u8BF7\u8F93\u5165ip",trigger:["blur","change"]}]}],[{type:"input",label:"\u7AEF\u53E3\u53F7\uFF1A",name:"port",placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7",inputType:"number",rules:[{required:!0,message:"\u8BF7\u8F93\u5165ip",trigger:["blur","change"]}]}],[{type:"input",label:"\u7528\u6237\u540D\uFF1A",name:"username",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["blur","change"]}]}],[{type:"input",label:"\u5BC6\u7801\uFF1A",name:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",inputType:"password"}]]},formData:{port:22}}});De(()=>{i()});const s=d=>{!d||(l.currentId=d.id,l.currentData=d)},y=d=>{const{href:c}=e.resolve({path:"/machine/terminal",query:{id:d.id,name:d.name}});window.open(c,"_blank")},$=d=>{let c;d?(l.formDialog.formData=l.currentData,c="\u7F16\u8F91\u673A\u5668"):(l.formDialog.formData={port:22},c="\u6DFB\u52A0\u673A\u5668"),l.formDialog.title=c,l.formDialog.visible=!0},D=async d=>{await A.del.request({id:d}),z.success("\u64CD\u4F5C\u6210\u529F"),i()},p=d=>{l.serviceDialog.machineId=d.id,l.serviceDialog.visible=!0,l.serviceDialog.title=`${d.name} => ${d.ip}`},h=()=>{l.currentId=null,l.currentData=null,i()},b=d=>{l.fileDialog.visible=!0,l.fileDialog.machineId=d.id,l.fileDialog.title=`${d.name} => ${d.ip}`},i=async()=>{const d=await A.list.request(l.params);l.data.list=d.list,l.data.total=d.total};return W(q({},j(l)),{choose:s,showTerminal:y,openFormDialog:$,deleteMachine:D,serviceManager:p,submitSuccess:h,fileManage:b,search:i})}}),Il={class:"toolbar"},kl={style:{float:"left"}},$l=F("\u6DFB\u52A0"),El=F("\u7F16\u8F91"),wl=F("\u5220\u9664"),Bl=F("\u6587\u4EF6\u7BA1\u7406"),Vl={style:{float:"right"}},Sl=k("i",null,null,-1),Al=F("\u7EC8\u7AEF");function Tl(e,l,s,y,$,D){const p=u("el-button"),h=u("el-input"),b=u("el-radio"),i=u("el-table-column"),d=u("el-table"),c=u("el-pagination"),C=u("service-manage"),B=u("file-manage"),E=u("dynamic-form-dialog"),a=ee("auth");return r(),w("div",null,[k("div",Il,[k("div",kl,[T((r(),v(p,{type:"primary",icon:"plus",onClick:l[0]||(l[0]=n=>e.openFormDialog(!1)),plain:""},{default:o(()=>[$l]),_:1})),[[a,"machine:add"]]),T((r(),v(p,{type:"primary",icon:"edit",size:"small",disabled:e.currentId==null,onClick:l[1]||(l[1]=n=>e.openFormDialog(e.currentData)),plain:""},{default:o(()=>[El]),_:1},8,["disabled"])),[[a,"machine:edit"]]),T((r(),v(p,{disabled:e.currentId==null,onClick:l[2]||(l[2]=n=>e.deleteMachine(e.currentId)),type:"danger",icon:"delete"},{default:o(()=>[wl]),_:1},8,["disabled"])),[[a,"machine:del"]]),T((r(),v(p,{icon:"files",type:"success",disabled:e.currentId==null,onClick:l[3]||(l[3]=n=>e.fileManage(e.currentData)),plain:""},{default:o(()=>[Bl]),_:1},8,["disabled"])),[[a,"machine:file"]])]),k("div",Vl,[t(h,{placeholder:"host",size:"small",style:{width:"140px"},modelValue:e.params.host,"onUpdate:modelValue":l[4]||(l[4]=n=>e.params.host=n),onClear:e.search,plain:"",clearable:""},null,8,["modelValue","onClear"]),t(p,{onClick:e.search,type:"success",icon:"el-icon-search",size:"small"},null,8,["onClick"])])]),t(d,{data:e.data.list,border:"",stripe:"",style:{width:"100%"},onCurrentChange:e.choose},{default:o(()=>[t(i,{label:"\u9009\u62E9",width:"55px"},{default:o(n=>[t(b,{modelValue:e.currentId,"onUpdate:modelValue":l[5]||(l[5]=U=>e.currentId=U),label:n.row.id},{default:o(()=>[Sl]),_:2},1032,["modelValue","label"])]),_:1}),t(i,{prop:"name",label:"\u540D\u79F0","min-width":60}),t(i,{prop:"ip",label:"IP",width:""}),t(i,{prop:"port",label:"\u7AEF\u53E3","min-width":40}),t(i,{prop:"username",label:"\u7528\u6237\u540D","min-width":45}),t(i,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":100},{default:o(n=>[F(L(e.$filters.dateFormat(n.row.createTime)),1)]),_:1}),t(i,{prop:"creator",label:"\u521B\u5EFA\u8005","min-width":50}),t(i,{prop:"updateTime",label:"\u66F4\u65B0\u65F6\u95F4","min-width":100},{default:o(n=>[F(L(e.$filters.dateFormat(n.row.updateTime)),1)]),_:1}),t(i,{prop:"modifier",label:"\u4FEE\u6539\u8005","min-width":50}),t(i,{label:"\u64CD\u4F5C","min-width":"200px"},{default:o(n=>[T((r(),v(p,{type:"success",onClick:U=>e.showTerminal(n.row),size:"small",plain:""},{default:o(()=>[Al]),_:2},1032,["onClick"])),[[a,"machine:terminal"]])]),_:1})]),_:1},8,["data","onCurrentChange"]),t(c,{style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.data.total,"current-page":e.params.pageNum,"onUpdate:current-page":l[6]||(l[6]=n=>e.params.pageNum=n),"page-size":e.params.pageSize},null,8,["total","current-page","page-size"]),t(C,{title:e.serviceDialog.title,visible:e.serviceDialog.visible,"onUpdate:visible":l[7]||(l[7]=n=>e.serviceDialog.visible=n),machineId:e.serviceDialog.machineId,"onUpdate:machineId":l[8]||(l[8]=n=>e.serviceDialog.machineId=n)},null,8,["title","visible","machineId"]),t(B,{title:e.fileDialog.title,visible:e.fileDialog.visible,"onUpdate:visible":l[9]||(l[9]=n=>e.fileDialog.visible=n),machineId:e.fileDialog.machineId,"onUpdate:machineId":l[10]||(l[10]=n=>e.fileDialog.machineId=n)},null,8,["title","visible","machineId"]),t(E,{visible:e.formDialog.visible,"onUpdate:visible":l[11]||(l[11]=n=>e.formDialog.visible=n),title:e.formDialog.title,formInfo:e.formDialog.formInfo,formData:e.formDialog.formData,"onUpdate:formData":l[12]||(l[12]=n=>e.formDialog.formData=n),onSubmitSuccess:e.submitSuccess},null,8,["visible","title","formInfo","formData","onSubmitSuccess"])])}var jl=G(_l,[["render",Tl]]);export{jl as default};
