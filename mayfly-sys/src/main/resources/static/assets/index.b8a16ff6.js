var ge=Object.defineProperty,ye=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var x=(e,l,a)=>l in e?ge(e,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[l]=a,A=(e,l)=>{for(var a in l||(l={}))De.call(l,a)&&x(e,a,l[a]);if(X)for(var a of X(l))_e.call(l,a)&&x(e,a,l[a]);return e},M=(e,l)=>ye(e,ve(l));import{s as q,r as Y,a as W,z as J,t as j,I as B,e as s,f as b,h,i as t,E as o,F as O,D as P,l as U,B as S,$ as ee,k as _,U as Z,j as K,J as Ce,o as Ie,P as Fe,w as G}from"./vendor.e3fc7715.js";import{A as $}from"./Api.3145ce1a.js";import{_ as le}from"./SshTerminal.6695fed5.js";import{E as te}from"./Enum.2b540114.js";import{n as H}from"./assert.dbc0392f.js";import{_ as ie}from"./codemirror.a19facba.js";import{g as $e,c as ne}from"./index.5944118c.js";var oe=q({name:"DynamicForm",props:{formInfo:{type:Object},formData:{type:[Object,Boolean]}},setup(e,l){const a=Y(),v=W({form:{},submitDisabled:!1});J(e.formData,(g,f)=>{e.formData&&(v.form=A({},e.formData))});const k=()=>{a.value.validate(g=>{if(g){const f=A({},v.form),i=v.form.id?e.formInfo.updateApi:e.formInfo.createApi;i?(v.submitDisabled=!0,i.request(v.form).then(u=>{B.success("\u4FDD\u5B58\u6210\u529F"),l.emit("submitSuccess",f),v.submitDisabled=!1},u=>{v.submitDisabled=!1})):B.error("\u8868\u5355\u672A\u8BBE\u7F6E\u5BF9\u5E94\u7684\u63D0\u4EA4\u6743\u9650")}else return!1})},D=()=>{l.emit("reset"),c()},c=()=>{a.resetFields(),v.form={}};return M(A({},j(v)),{dynamicForm:a,submit:k,reset:D,resetFieldsAndData:c})}});const ke={class:"dynamic-form"},we={key:1},Ve=_("\u91CD \u7F6E"),Ee=_("\u4FDD \u5B58");function Se(e,l,a,v,k,D){const c=s("el-input"),g=s("el-option"),f=s("el-select"),i=s("el-form-item"),u=s("el-col"),p=s("el-row"),I=s("el-button"),w=s("el-form");return b(),h("div",ke,[t(w,{model:e.form,ref:"dynamicForm","label-width":e.formInfo.labelWidth?e.formInfo.labelWidth:"100px",size:e.formInfo.size?e.formInfo.size:"small"},{default:o(()=>[(b(!0),h(O,null,P(e.formInfo.formRows,C=>(b(),h(p,{key:C.key},{default:o(()=>[(b(!0),h(O,null,P(C,n=>(b(),h(u,{key:n.key,span:n.span?n.span:24/C.length},{default:o(()=>[t(i,{prop:n.name,label:n.label,"label-width":n.labelWidth,required:n.required,rules:n.rules},{default:o(()=>[n.type==="input"?(b(),h(c,{key:0,modelValue:e.form[n.name],"onUpdate:modelValue":r=>e.form[n.name]=r,modelModifiers:{trim:!0},placeholder:n.placeholder,type:n.inputType,clearable:"",onChange:r=>n.change?n.change(e.form):""},null,8,["modelValue","onUpdate:modelValue","placeholder","type","onChange"])):n.type==="text"?(b(),h("span",we,U(e.form[n.name]),1)):n.type==="select"?(b(),h(f,{key:2,modelValue:e.form[n.name],"onUpdate:modelValue":r=>e.form[n.name]=r,modelModifiers:{trim:!0},placeholder:n.placeholder,filterable:n.filterable,remote:n.remote,"remote-method":n.remoteMethod,onFocus:r=>n.focus?n.focus(e.form):"",clearable:"",disabled:n.updateDisabled&&e.form.id!=null,style:{width:"100%"}},{default:o(()=>[(b(!0),h(O,null,P(n.options,r=>(b(),h(g,{key:r.key,label:r[n.optionProps&&n.optionProps.label||"label"],value:r[n.optionProps&&n.optionProps.value||"value"]},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","filterable","remote","remote-method","onFocus","disabled"])):S("",!0)]),_:2},1032,["prop","label","label-width","required","rules"])]),_:2},1032,["span"]))),128))]),_:2},1024))),128)),t(p,{type:"flex",justify:"center"},{default:o(()=>[ee(e.$slots,"btns",{submitDisabled:e.submitDisabled,data:e.form,submit:e.submit},()=>[t(I,{onClick:e.reset,size:"mini"},{default:o(()=>[Ve]),_:1},8,["onClick"]),t(I,{type:"primary",onClick:e.submit,size:"mini"},{default:o(()=>[Ee]),_:1},8,["onClick"])])]),_:3})]),_:1},8,["model","label-width","size"])])}oe.render=Se;var ae=q({name:"DynamicFormDialog",components:{DynamicForm:oe},props:{visible:{type:Boolean},dialogWidth:{type:String},title:{type:String},formInfo:{type:Object},formData:{type:[Object,Boolean]}},setup(e,l){const a=Y(),v=()=>{l.emit("update:visible",!1),l.emit("update:formData",null),l.emit("close"),setTimeout(()=>{a.resetFieldsAndData()},200)};return{df:a,close:v,submitSuccess:D=>{l.emit("submitSuccess",D),v()}}}});const Be={class:"form-dialog"},Te=_("\u4FDD \u5B58"),Ae=_("\u53D6 \u6D88");function ze(e,l,a,v,k,D){const c=s("el-button"),g=s("dynamic-form"),f=s("el-dialog");return b(),h("div",Be,[t(f,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[2]||(l[2]=i=>e.visible=i),width:e.dialogWidth?e.dialogWidth:"500px"},{default:o(()=>[t(g,{ref:"df","form-info":e.formInfo,"form-data":e.formData,onSubmitSuccess:e.submitSuccess},{btns:o(i=>[ee(e.$slots,"btns",{},()=>[t(c,{disabled:i.submitDisabled,type:"primary",onClick:i.submit,size:"mini"},{default:o(()=>[Te]),_:2},1032,["disabled","onClick"]),t(c,{disabled:i.submitDisabled,onClick:l[1]||(l[1]=u=>e.close()),size:"mini"},{default:o(()=>[Ae]),_:2},1032,["disabled"])])]),_:1},8,["form-info","form-data","onSubmitSuccess"])]),_:1},8,["title","modelValue","width"])])}ae.render=ze;const E={list:$.create("/machines","get"),info:$.create("/machines/{id}/sysinfo","get"),top:$.create("/machines/{id}/top","get"),save:$.create("/machines","post"),del:$.create("/machines/{id}","delete"),scripts:$.create("/machines/{machineId}/scripts","get"),runScript:$.create("/machines/{machineId}/scripts/{scriptId}/run","get"),saveScript:$.create("/machines/{machineId}/scripts","post"),deleteScript:$.create("/machines/{machineId}/scripts/{scriptId}","delete"),files:$.create("/machines/{id}/files","get"),lsFile:$.create("/machines/{machineId}/files/{fileId}/read-dir","get"),rmFile:$.create("/machines/{machineId}/files/{fileId}/remove","delete"),uploadFile:$.create("/machines/files/upload","post"),fileContent:$.create("/machines/{machineId}/files/{fileId}/read","get"),updateFileContent:$.create("/machines/{machineId}/files/{id}/write","post"),addConf:$.create("/machines/{machineId}/files","post"),delConf:$.create("/machines/{machineId}/files/{id}","delete"),terminal:$.create("/api/machines/{id}/terminal","get")};var N={scriptTypeEnum:new te().add("RESULT","\u6709\u7ED3\u679C",1).add("NO_RESULT","\u65E0\u7ED3\u679C",2).add("REAL_TIME","\u5B9E\u65F6\u4EA4\u4E92",3),FileTypeEnum:new te().add("DIRECTORY","\u76EE\u5F55",1).add("FILE","\u6587\u4EF6",2)},se=q({name:"ScriptEdit",components:{codemirror:ie},props:{visible:{type:Boolean},data:{type:Object},title:{type:String},machineId:{type:Number},isCommon:{type:Boolean}},setup(e,{emit:l}){const{isCommon:a,machineId:v}=j(e),k=Y(null),D=W({visible:!1,submitDisabled:!1,form:{id:null,name:"",machineId:0,description:"",script:"",type:null},btnLoading:!1});J(e,(f,i)=>{f.data?D.form=A({},f.data):(D.form={},D.form.script=""),D.visible=f.visible});const c=()=>{D.form.machineId=a?9999999:v,k.value.validate(f=>{if(f)H(D.form.name,"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"),H(D.form.description,"\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),H(D.form.script,"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),E.saveScript.request(D.form).then(i=>{B.success("\u4FDD\u5B58\u6210\u529F"),l("submitSuccess"),D.submitDisabled=!1,g()},i=>{D.submitDisabled=!1});else return!1})},g=()=>{l("update:visible",!1),l("cancel")};return M(A({},j(D)),{enums:N,mockDataForm:k,btnOk:c,cancel:g})}}),Rl="";const Ue={class:"mock-data-dialog"},Me={class:"dialog-footer"},qe=_("\u4FDD \u5B58"),je=_("\u5173 \u95ED");function Ne(e,l,a,v,k,D){const c=s("el-input"),g=s("el-form-item"),f=s("el-option"),i=s("el-select"),u=s("codemirror"),p=s("el-form"),I=s("el-button"),w=s("el-dialog");return b(),h("div",Ue,[t(w,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[6]||(l[6]=C=>e.visible=C),"close-on-click-modal":!1,"before-close":e.cancel,"show-close":!0,"destroy-on-close":!0,width:"800px"},{footer:o(()=>[t("div",Me,[t(I,{type:"primary",loading:e.btnLoading,onClick:e.btnOk,size:"mini",disabled:e.submitDisabled},{default:o(()=>[qe]),_:1},8,["loading","onClick","disabled"]),t(I,{onClick:l[5]||(l[5]=C=>e.cancel()),disabled:e.submitDisabled,size:"mini"},{default:o(()=>[je]),_:1},8,["disabled"])])]),default:o(()=>[t(p,{model:e.form,ref:"mockDataForm","label-width":"70px",size:"small"},{default:o(()=>[t(g,{prop:"method",label:"\u540D\u79F0"},{default:o(()=>[t(c,{modelValue:e.form.name,"onUpdate:modelValue":l[1]||(l[1]=C=>e.form.name=C),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(g,{prop:"description",label:"\u63CF\u8FF0"},{default:o(()=>[t(c,{modelValue:e.form.description,"onUpdate:modelValue":l[2]||(l[2]=C=>e.form.description=C),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),t(g,{prop:"type",label:"\u7C7B\u578B"},{default:o(()=>[t(i,{modelValue:e.form.type,"onUpdate:modelValue":l[3]||(l[3]=C=>e.form.type=C),"default-first-option":"",style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B"},{default:o(()=>[(b(!0),h(O,null,P(e.enums.scriptTypeEnum,C=>(b(),h(f,{key:C.value,label:C.label,value:C.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{prop:"script",label:"\u5185\u5BB9",id:"content"},{default:o(()=>[t(u,{ref:"cmEditor",modelValue:e.form.script,"onUpdate:modelValue":l[4]||(l[4]=C=>e.form.script=C),language:"shell"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}se.render=Ne;var re=q({name:"ServiceManage",components:{ScriptEdit:se,SshTerminal:le},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,l){const a=W({visible:!1,type:0,currentId:null,currentData:null,editDialog:{visible:!1,data:null,title:"",machineId:9999999},scriptTable:[],resultDialog:{visible:!1,result:""},terminalDialog:{visible:!1,cmd:"",machineId:0}});J(e,(p,I)=>{e.machineId&&v(),a.visible=p.visible});const v=async()=>{a.currentId=null,a.currentData=null;const p=a.type==0?e.machineId:9999999,I=await E.scripts.request({machineId:p});a.scriptTable=I.list},k=async p=>{const I=p.type==N.scriptTypeEnum.NO_RESULT.value;if(p.type==N.scriptTypeEnum.RESULT.value||I){const w=await E.runScript.request({machineId:e.machineId,scriptId:p.id});if(I){B.success("\u6267\u884C\u5B8C\u6210");return}a.resultDialog.result=w,a.resultDialog.visible=!0;return}if(p.type==N.scriptTypeEnum.REAL_TIME.value){a.terminalDialog.cmd=p.script,a.terminalDialog.visible=!0,a.terminalDialog.machineId=e.machineId;return}},D=()=>{a.terminalDialog.visible=!1,a.terminalDialog.machineId=0},c=p=>{!p||(a.currentId=p.id,a.currentData=p)},g=p=>{a.editDialog.machineId=e.machineId,a.editDialog.data=p,p?a.editDialog.title="\u67E5\u770B\u7F16\u8F91\u811A\u672C":a.editDialog.title="\u65B0\u589E\u811A\u672C",a.editDialog.visible=!0},f=()=>{v()},i=p=>{Z.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${p.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{E.deleteScript.request({machineId:e.machineId,scriptId:p.id}).then(I=>{v()})})},u=()=>{l.emit("update:visible",!1),l.emit("update:machineId",null),l.emit("cancel"),a.scriptTable=[]};return M(A({},j(a)),{enums:N,getScripts:v,runScript:k,closeTermnial:D,choose:c,editScript:g,submitSuccess:f,deleteRow:i,handleClose:u})}}),Ll="";const Re={class:"file-manage"},Le={class:"toolbar"},We={style:{float:"left"}},Oe={style:{float:"right"}},Pe=_("\u67E5\u770B"),Ge=_("\u6DFB\u52A0"),Ye=_("\u5220\u9664"),Je=t("i",null,null,-1),Ke=_("\u786E\u5B9A"),Ze=_("\u6267\u884C"),He={style:{"white-space":"pre-line",padding:"10px",color:"#000000"}};function Qe(e,l,a,v,k,D){const c=s("el-option"),g=s("el-select"),f=s("el-button"),i=s("el-radio"),u=s("el-table-column"),p=s("el-table"),I=s("el-dialog"),w=s("ssh-terminal"),C=s("script-edit");return b(),h("div",Re,[t(I,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[6]||(l[6]=n=>e.visible=n),"destroy-on-close":!0,"show-close":!0,"before-close":e.handleClose,width:"60%"},{default:o(()=>[t("div",Le,[t("div",We,[t(g,{modelValue:e.type,"onUpdate:modelValue":l[1]||(l[1]=n=>e.type=n),onChange:e.getScripts,size:"mini",placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[t(c,{key:0,label:"\u79C1\u6709",value:0}),t(c,{key:1,label:"\u516C\u5171",value:1})]),_:1},8,["modelValue","onChange"])]),t("div",Oe,[t(f,{onClick:l[2]||(l[2]=n=>e.editScript(e.currentData)),disabled:e.currentId==null,type:"primary",icon:"el-icon-tickets",size:"mini",plain:""},{default:o(()=>[Pe]),_:1},8,["disabled"]),t(f,{type:"primary",onClick:l[3]||(l[3]=n=>e.editScript(null)),icon:"el-icon-plus",size:"mini",plain:""},{default:o(()=>[Ge]),_:1}),t(f,{disabled:e.currentId==null,type:"danger",onClick:l[4]||(l[4]=n=>e.deleteRow(e.currentData)),icon:"el-icon-delete",size:"mini",plain:""},{default:o(()=>[Ye]),_:1},8,["disabled"])])]),t(p,{data:e.scriptTable,onCurrentChange:e.choose,stripe:"",border:"",size:"mini",style:{width:"100%"}},{default:o(()=>[t(u,{label:"\u9009\u62E9",width:"55px"},{default:o(n=>[t(i,{modelValue:e.currentId,"onUpdate:modelValue":l[5]||(l[5]=r=>e.currentId=r),label:n.row.id},{default:o(()=>[Je]),_:2},1032,["modelValue","label"])]),_:1}),t(u,{prop:"name",label:"\u540D\u79F0","min-width":50}),t(u,{prop:"description",label:"\u63CF\u8FF0","min-width":100,"show-overflow-tooltip":""}),t(u,{prop:"name",label:"\u7C7B\u578B","min-width":50},{default:o(n=>[_(U(e.enums.scriptTypeEnum.getLabelByValue(n.row.type)),1)]),_:1}),t(u,{label:"\u64CD\u4F5C"},{default:o(n=>[n.row.id==null?(b(),h(f,{key:0,onClick:r=>e.addFiles(n.row),type:"success",icon:"el-icon-success",size:"mini",plain:""},{default:o(()=>[Ke]),_:2},1032,["onClick"])):S("",!0),n.row.id!=null?(b(),h(f,{key:1,onClick:r=>e.runScript(n.row),type:"primary",icon:"el-icon-tickets",size:"mini",plain:""},{default:o(()=>[Ze]),_:2},1032,["onClick"])):S("",!0)]),_:1})]),_:1},8,["data","onCurrentChange"])]),_:1},8,["title","modelValue","before-close"]),t(I,{title:"\u6267\u884C\u7ED3\u679C",modelValue:e.resultDialog.visible,"onUpdate:modelValue":l[7]||(l[7]=n=>e.resultDialog.visible=n),width:"40%"},{default:o(()=>[t("div",He,U(e.resultDialog.result),1)]),_:1},8,["modelValue"]),e.terminalDialog.visible?(b(),h(I,{key:0,title:"\u7EC8\u7AEF",modelValue:e.terminalDialog.visible,"onUpdate:modelValue":l[8]||(l[8]=n=>e.terminalDialog.visible=n),width:"70%","close-on-click-modal":!1,modal:!1,onClose:e.closeTermnial},{default:o(()=>[t(w,{ref:"terminal",cmd:e.terminalDialog.cmd,machineId:e.terminalDialog.machineId,height:"600px"},null,8,["cmd","machineId"])]),_:1},8,["modelValue","onClose"])):S("",!0),t(C,{visible:e.editDialog.visible,"onUpdate:visible":l[9]||(l[9]=n=>e.editDialog.visible=n),data:e.editDialog.data,"onUpdate:data":l[10]||(l[10]=n=>e.editDialog.data=n),title:e.editDialog.title,machineId:e.editDialog.machineId,"onUpdate:machineId":l[11]||(l[11]=n=>e.editDialog.machineId=n),isCommon:e.type==1,onSubmitSuccess:e.submitSuccess},null,8,["visible","data","title","machineId","isCommon","onSubmitSuccess"])])}re.render=Qe;var de=q({name:"FileManage",components:{codemirror:ie},props:{visible:{type:Boolean},machineId:{type:Number},title:{type:String}},setup(e,{emit:l}){const a=E.addConf,v=E.delConf,k=E.updateFileContent,D=E.files,c=Y(null),g=$e("token"),f={tabSize:2,mode:"text/x-sh",theme:"panda-syntax",line:!0,lint:!0,gutters:["CodeMirror-lint-markers"],indentWithTabs:!0,smartIndent:!0,matchBrackets:!0,autofocus:!0,styleSelectedText:!0,styleActiveLine:!0,foldGutter:!0,hintOptions:{completeSingle:!0}},i=W({visible:!1,form:{id:null,type:null,name:"",remark:""},fileTable:[],btnLoading:!1,fileContent:{fileId:0,content:"",contentVisible:!1,dialogTitle:"",path:"",type:"shell"},tree:{title:"",visible:!1,folder:{id:0},node:{childNodes:[]},resolve:{}},props:{label:"name",children:"zones",isLeaf:"leaf"}});J(e,(d,F)=>{d.machineId&&u(),i.visible=d.visible});const u=async()=>{const d=await D.request({id:e.machineId});i.fileTable=d},p=()=>{i.fileTable=[{}].concat(i.fileTable)},I=async d=>{d.machineId=e.machineId,await a.request(d),B.success("\u6DFB\u52A0\u6210\u529F"),u()},w=(d,F)=>{F.id?Z.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${F.name}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{v.request({machineId:e.machineId,id:F.id}).then(V=>{i.fileTable.splice(d,1)})}):i.fileTable.splice(d,1)},C=d=>{if(d.type==1){i.tree.folder=d,i.tree.title=d.name,i.tree.node.childNodes=[],R(i.tree.node,i.tree.resolve),i.tree.visible=!0;return}n(d.id,d.path)},n=async(d,F)=>{const V=await E.fileContent.request({fileId:d,path:F,machineId:e.machineId});i.fileContent.content=V,i.fileContent.fileId=d,i.fileContent.dialogTitle=F,i.fileContent.path=F,i.fileContent.type=r(F),i.fileContent.contentVisible=!0},r=d=>d.endsWith(".sh")?"shell":d.endsWith("js")||d.endsWith("json")?"javascript":d.endsWith("Dockerfile")?"dockerfile":d.endsWith("nginx.conf")?"nginx":d.endsWith("yaml")||d.endsWith("yml")?"yaml":d.endsWith("xml")||d.endsWith("html")?"html":"text",m=async()=>{await k.request({content:i.fileContent.content,id:i.fileContent.fileId,path:i.fileContent.path,machineId:e.machineId}),B.success("\u4FEE\u6539\u6210\u529F"),i.fileContent.contentVisible=!1,i.fileContent.content=""},y=()=>{l("update:visible",!1),l("update:machineId",null),l("cancel"),i.fileTable=[],i.tree.folder={id:0}},R=async(d,F)=>{if(typeof F!="function")return;const V=i.tree.folder;if(d.level===0){i.tree.node=d,i.tree.resolve=F;const L=V?V.path:"/";return F([{name:L,type:"d",path:L}])}let z;const T=d.data;!T||T.name==T.path?z=V.path:z=T.path;const Q=await E.lsFile.request({fileId:V.id,machineId:e.machineId,path:z});for(const L of Q)L.type!="d"&&(L.leaf=!0);return F(Q)},me=(d,F)=>{const V=F.path;Z.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${V}], \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{E.rmFile.request({fileId:i.tree.folder.id,path:V,machineId:e.machineId}).then(z=>{B.success("\u5220\u9664\u6210\u529F"),c.value.remove(d)})}).catch(()=>{})},ce=(d,F)=>{const V=document.createElement("a");V.setAttribute("href",`${ne.baseApiUrl}/machines/${e.machineId}/files/${i.tree.folder.id}/download?&path=${F.path}&token=${g}`),V.click()},pe=d=>`${ne.baseApiUrl}/machines/${e.machineId}/files/${i.tree.folder.id}/upload?token=${g}`,fe=d=>{d.code==200?B.success("\u6587\u4EF6\u4E0A\u4F20\u4E2D..."):B.error(d.msg)},be=d=>{const F=d.path;return["/","//","/usr","/usr/","/usr/bin","/opt","/run","/etc","/proc","/var","/mnt","/boot","/dev","/home","/media","/root"].indexOf(F)!=-1},he=d=>{const F=Number(d);if(d&&!isNaN(F)){const V=["B","KB","MB","GB","TB","PB","EB","ZB","YB","BB"];let z=0,T=F;if(F>=1024)for(;T>1024;)T=T/1024,z++;return`${T.toFixed(2)}${V[z]}`}return"-"};return M(A({},j(i)),{fileTree:c,enums:N,token:g,cmOptions:f,add:p,getFiles:u,addFiles:I,deleteRow:w,getConf:C,getFileContent:n,updateContent:m,handleClose:y,loadNode:R,deleteFile:me,downloadFile:ce,getUploadFile:pe,uploadSuccess:fe,dontOperate:be,formatFileSize:he})}}),Wl="";const Xe={class:"file-manage"},xe={class:"toolbar"},el={style:{float:"right"}},ll=_("\u6DFB\u52A0"),tl=_("\u786E\u5B9A"),il=_("\u67E5\u770B"),nl=_("\u5220\u9664"),ol={style:{height:"45vh",overflow:"auto"}},al={class:"custom-tree-node"},sl={key:0},rl=t("i",{class:"el-icon-folder"},null,-1),dl={key:1},ul=t("i",{class:"el-icon-folder-opened"},null,-1),ml={key:2},cl=t("i",{class:"el-icon-document"},null,-1),pl={style:{display:"inline-block",width:"430px"}},fl={key:0,style:{color:"#67c23a"}},bl={class:"dialog-footer"},hl=_("\u4FDD \u5B58"),gl=_("\u5173 \u95ED");function yl(e,l,a,v,k,D){const c=s("el-button"),g=s("el-input"),f=s("el-table-column"),i=s("el-option"),u=s("el-select"),p=s("el-table"),I=s("el-dialog"),w=s("el-link"),C=s("el-upload"),n=s("el-tree"),r=s("codemirror");return b(),h("div",Xe,[t(I,{title:e.title,modelValue:e.visible,"onUpdate:modelValue":l[1]||(l[1]=m=>e.visible=m),"show-close":!0,"before-close":e.handleClose,width:"800px"},{default:o(()=>[t("div",xe,[t("div",el,[t(c,{type:"primary",onClick:e.add,icon:"el-icon-plus",size:"mini",plain:""},{default:o(()=>[ll]),_:1},8,["onClick"])])]),t(p,{data:e.fileTable,stripe:"",style:{width:"100%"}},{default:o(()=>[t(f,{prop:"name",label:"\u540D\u79F0",width:""},{default:o(m=>[t(g,{modelValue:m.row.name,"onUpdate:modelValue":y=>m.row.name=y,size:"mini",disabled:m.row.id!=null,clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(f,{prop:"name",label:"\u7C7B\u578B","min-width":"50px"},{default:o(m=>[t(u,{disabled:m.row.id!=null,size:"mini",modelValue:m.row.type,"onUpdate:modelValue":y=>m.row.type=y,style:{width:"100px"},placeholder:"\u8BF7\u9009\u62E9"},{default:o(()=>[(b(!0),h(O,null,P(e.enums.FileTypeEnum,y=>(b(),h(i,{key:y.value,label:y.label,value:y.value},null,8,["label","value"]))),128))]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])]),_:1}),t(f,{prop:"path",label:"\u8DEF\u5F84",width:""},{default:o(m=>[t(g,{modelValue:m.row.path,"onUpdate:modelValue":y=>m.row.path=y,disabled:m.row.id!=null,size:"mini",clearable:""},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),t(f,{label:"\u64CD\u4F5C",width:""},{default:o(m=>[m.row.id==null?(b(),h(c,{key:0,onClick:y=>e.addFiles(m.row),type:"success",icon:"el-icon-success",size:"mini",plain:""},{default:o(()=>[tl]),_:2},1032,["onClick"])):S("",!0),m.row.id!=null?(b(),h(c,{key:1,onClick:y=>e.getConf(m.row),type:"primary",icon:"el-icon-tickets",size:"mini",plain:""},{default:o(()=>[il]),_:2},1032,["onClick"])):S("",!0),t(c,{type:"danger",onClick:y=>e.deleteRow(m.$index,m.row),icon:"el-icon-delete",size:"mini",plain:""},{default:o(()=>[nl]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue","before-close"]),t(I,{title:e.tree.title,modelValue:e.tree.visible,"onUpdate:modelValue":l[3]||(l[3]=m=>e.tree.visible=m),"close-on-click-modal":!1,width:"680px"},{default:o(()=>[t("div",ol,[t(n,{ref:"fileTree",load:e.loadNode,props:e.props,lazy:"","node-key":"id","expand-on-click-node":!1},{default:o(({node:m,data:y})=>[t("span",al,[y.type=="d"&&!m.expanded?(b(),h("span",sl,[rl])):S("",!0),y.type=="d"&&m.expanded?(b(),h("span",dl,[ul])):S("",!0),y.type=="-"?(b(),h("span",ml,[cl])):S("",!0),t("span",pl,[_(U(m.label)+" ",1),y.type=="-"?(b(),h("span",fl,"\xA0\xA0["+U(e.formatFileSize(y.size))+"]",1)):S("",!0)]),t("span",null,[y.type=="-"&&y.size<1*1024*1024?(b(),h(w,{key:0,onClick:K(R=>e.getFileContent(e.tree.folder.id,y.path),["prevent"]),type:"info",icon:"el-icon-view",underline:!1},null,8,["onClick"])):S("",!0),t(C,{"on-success":e.uploadSuccess,headers:{token:e.token},data:{fileId:e.tree.folder.id,path:y.path,machineId:e.machineId},action:e.getUploadFile({path:y.path}),"show-file-list":!1,name:"file",multiple:"",limit:100,style:{display:"inline-block","margin-left":"2px"}},{default:o(()=>[y.type=="d"?(b(),h(w,{key:0,onClick:l[2]||(l[2]=K(()=>{},["prevent"])),icon:"el-icon-upload",underline:!1})):S("",!0)]),_:2},1032,["on-success","headers","data","action"]),y.type=="-"?(b(),h(w,{key:1,onClick:K(R=>e.downloadFile(m,y),["prevent"]),type:"danger",icon:"el-icon-download",underline:!1,style:{"margin-left":"2px"}},null,8,["onClick"])):S("",!0),e.dontOperate(y)?S("",!0):(b(),h(w,{key:2,onClick:K(R=>e.deleteFile(m,y),["prevent"]),type:"danger",icon:"el-icon-delete",underline:!1,style:{"margin-left":"2px"}},null,8,["onClick"]))])])]),_:1},8,["load","props"])])]),_:1},8,["title","modelValue"]),t(I,{"destroy-on-close":!0,title:e.fileContent.dialogTitle,modelValue:e.fileContent.contentVisible,"onUpdate:modelValue":l[6]||(l[6]=m=>e.fileContent.contentVisible=m),"close-on-click-modal":!1,top:"5vh",width:"70%"},{footer:o(()=>[t("div",bl,[t(c,{type:"primary",onClick:e.updateContent,size:"mini"},{default:o(()=>[hl]),_:1},8,["onClick"]),t(c,{onClick:l[5]||(l[5]=m=>e.fileContent.contentVisible=!1),size:"mini"},{default:o(()=>[gl]),_:1})])]),default:o(()=>[t("div",null,[t(r,{"can-change-mode":!0,ref:"cmEditor",modelValue:e.fileContent.content,"onUpdate:modelValue":l[4]||(l[4]=m=>e.fileContent.content=m),language:e.fileContent.type},null,8,["modelValue","language"])])]),_:1},8,["title","modelValue"])])}de.render=yl;var ue=q({name:"MachineList",components:{SshTerminal:le,ServiceManage:re,FileManage:de,DynamicFormDialog:ae},setup(){const e=Ce(),l=W({params:{pageNum:1,pageSize:10,host:null,clusterId:null},data:{list:[],total:10},currentId:null,currentData:null,infoDialog:{visible:!1,info:""},serviceDialog:{visible:!1,machineId:0,title:""},fileDialog:{visible:!1,machineId:0,title:""},monitorDialog:{visible:!1,machineId:0},formDialog:{visible:!1,title:"",formInfo:{createApi:E.save,updateApi:E.save,formRows:[[{type:"input",label:"\u540D\u79F0\uFF1A",name:"name",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["blur","change"]}]}],[{type:"input",label:"ip\uFF1A",name:"ip",placeholder:"\u8BF7\u8F93\u5165ip",rules:[{required:!0,message:"\u8BF7\u8F93\u5165ip",trigger:["blur","change"]}]}],[{type:"input",label:"\u7AEF\u53E3\u53F7\uFF1A",name:"port",placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3\u53F7",inputType:"number",rules:[{required:!0,message:"\u8BF7\u8F93\u5165ip",trigger:["blur","change"]}]}],[{type:"input",label:"\u7528\u6237\u540D\uFF1A",name:"username",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["blur","change"]}]}],[{type:"input",label:"\u5BC6\u7801\uFF1A",name:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",inputType:"password"}]]},formData:{port:22}}});Ie(()=>{i()});const a=u=>{!u||(l.currentId=u.id,l.currentData=u)},v=u=>{const{href:p}=e.resolve({path:"/machine/terminal",query:{id:u.id,name:u.name}});window.open(p,"_blank")},k=u=>{let p;u?(l.formDialog.formData=l.currentData,p="\u7F16\u8F91\u673A\u5668"):(l.formDialog.formData={port:22},p="\u6DFB\u52A0\u673A\u5668"),l.formDialog.title=p,l.formDialog.visible=!0},D=async u=>{await E.del.request({id:u}),B.success("\u64CD\u4F5C\u6210\u529F"),i()},c=u=>{l.serviceDialog.machineId=u.id,l.serviceDialog.visible=!0,l.serviceDialog.title=`${u.name} => ${u.ip}`},g=()=>{l.currentId=null,l.currentData=null,i()},f=u=>{l.fileDialog.visible=!0,l.fileDialog.machineId=u.id,l.fileDialog.title=`${u.name} => ${u.ip}`},i=async()=>{const u=await E.list.request(l.params);l.data.list=u.list,l.data.total=u.total};return M(A({},j(l)),{choose:a,showTerminal:v,openFormDialog:k,deleteMachine:D,serviceManager:c,submitSuccess:g,fileManage:f,search:i})}}),Ol="";const vl={class:"toolbar"},Dl={style:{float:"left"}},_l=_("\u6DFB\u52A0"),Cl=_("\u7F16\u8F91"),Il=_("\u5220\u9664"),Fl=_("\u6587\u4EF6\u7BA1\u7406"),$l={style:{float:"right"}},kl=t("i",null,null,-1),wl=_("\u76D1\u63A7"),Vl=_("\u811A\u672C\u7BA1\u7406"),El=_("\u7EC8\u7AEF");function Sl(e,l,a,v,k,D){const c=s("el-button"),g=s("el-input"),f=s("el-radio"),i=s("el-table-column"),u=s("el-table"),p=s("el-pagination"),I=s("service-manage"),w=s("file-manage"),C=s("dynamic-form-dialog"),n=Fe("auth");return b(),h("div",null,[t("div",vl,[t("div",Dl,[G(t(c,{type:"primary",icon:"el-icon-plus",size:"mini",onClick:l[1]||(l[1]=r=>e.openFormDialog(!1)),plain:""},{default:o(()=>[_l]),_:1},512),[[n,"machine:add"]]),G(t(c,{type:"primary",icon:"el-icon-edit",size:"mini",disabled:e.currentId==null,onClick:l[2]||(l[2]=r=>e.openFormDialog(e.currentData)),plain:""},{default:o(()=>[Cl]),_:1},8,["disabled"]),[[n,"machine:edit"]]),G(t(c,{disabled:e.currentId==null,onClick:l[3]||(l[3]=r=>e.deleteMachine(e.currentId)),type:"danger",icon:"el-icon-delete",size:"mini"},{default:o(()=>[Il]),_:1},8,["disabled"]),[[n,"machine:del"]]),G(t(c,{type:"success",disabled:e.currentId==null,onClick:l[4]||(l[4]=r=>e.fileManage(e.currentData)),size:"mini",plain:""},{default:o(()=>[Fl]),_:1},8,["disabled"]),[[n,"machine:file"]])]),t("div",$l,[t(g,{placeholder:"host",size:"mini",style:{width:"140px"},modelValue:e.params.host,"onUpdate:modelValue":l[5]||(l[5]=r=>e.params.host=r),onClear:e.search,plain:"",clearable:""},null,8,["modelValue","onClear"]),t(c,{onClick:e.search,type:"success",icon:"el-icon-search",size:"mini"},null,8,["onClick"])])]),t(u,{data:e.data.list,border:"",stripe:"",style:{width:"100%"},onCurrentChange:e.choose},{default:o(()=>[t(i,{label:"\u9009\u62E9",width:"55px"},{default:o(r=>[t(f,{modelValue:e.currentId,"onUpdate:modelValue":l[6]||(l[6]=m=>e.currentId=m),label:r.row.id},{default:o(()=>[kl]),_:2},1032,["modelValue","label"])]),_:1}),t(i,{prop:"name",label:"\u540D\u79F0",width:""}),t(i,{prop:"ip",label:"IP",width:""}),t(i,{prop:"port",label:"\u7AEF\u53E3","min-width":40}),t(i,{prop:"username",label:"\u7528\u6237\u540D","min-width":40}),t(i,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":100},{default:o(r=>[_(U(e.$filters.dateFormat(r.row.createTime)),1)]),_:1}),t(i,{prop:"creator",label:"\u521B\u5EFA\u8005","min-width":50}),t(i,{prop:"updateTime",label:"\u66F4\u65B0\u65F6\u95F4","min-width":100},{default:o(r=>[_(U(e.$filters.dateFormat(r.row.updateTime)),1)]),_:1}),t(i,{prop:"modifier",label:"\u4FEE\u6539\u8005","min-width":50}),t(i,{label:"\u64CD\u4F5C","min-width":"200px"},{default:o(r=>[t(c,{type:"primary",onClick:m=>e.monitor(r.row.id),icom:"el-icon-tickets",size:"mini",plain:""},{default:o(()=>[wl]),_:2},1032,["onClick"]),t(c,{type:"success",onClick:m=>e.serviceManager(r.row),size:"mini",plain:""},{default:o(()=>[Vl]),_:2},1032,["onClick"]),G(t(c,{type:"success",onClick:m=>e.showTerminal(r.row),size:"mini",plain:""},{default:o(()=>[El]),_:2},1032,["onClick"]),[[n,"machine:terminal"]])]),_:1})]),_:1},8,["data","onCurrentChange"]),t(p,{style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.data.total,"current-page":e.params.pageNum,"onUpdate:current-page":l[7]||(l[7]=r=>e.params.pageNum=r),"page-size":e.params.pageSize},null,8,["total","current-page","page-size"]),t(I,{title:e.serviceDialog.title,visible:e.serviceDialog.visible,"onUpdate:visible":l[8]||(l[8]=r=>e.serviceDialog.visible=r),machineId:e.serviceDialog.machineId,"onUpdate:machineId":l[9]||(l[9]=r=>e.serviceDialog.machineId=r)},null,8,["title","visible","machineId"]),t(w,{title:e.fileDialog.title,visible:e.fileDialog.visible,"onUpdate:visible":l[10]||(l[10]=r=>e.fileDialog.visible=r),machineId:e.fileDialog.machineId,"onUpdate:machineId":l[11]||(l[11]=r=>e.fileDialog.machineId=r)},null,8,["title","visible","machineId"]),t(C,{visible:e.formDialog.visible,"onUpdate:visible":l[12]||(l[12]=r=>e.formDialog.visible=r),title:e.formDialog.title,formInfo:e.formDialog.formInfo,formData:e.formDialog.formData,"onUpdate:formData":l[13]||(l[13]=r=>e.formDialog.formData=r),onSubmitSuccess:e.submitSuccess},null,8,["visible","title","formInfo","formData","onSubmitSuccess"])])}ue.render=Sl;export default ue;
