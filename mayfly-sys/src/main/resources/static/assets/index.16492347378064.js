var H=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var P=(e,o,l)=>o in e?H(e,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[o]=l,w=(e,o)=>{for(var l in o||(o={}))Q.call(o,l)&&P(e,l,o[l]);if(K)for(var l of K(o))W.call(o,l)&&P(e,l,o[l]);return e},$=(e,o)=>G(e,J(o));import{y as T,a as q,F as L,t as A,d as i,q as b,e as C,j as s,k as a,f as k,h as y,r as X,E as S,i as _,H as B,P as O,g as j,x as Y,o as Z,V as x,w as V,G as I}from"./vendor.1649234737806.js";import{a as F,e as z,r as ee}from"./enums.1649234737806.js";import{_ as U}from"./index.1649234737806.js";import"./Api.1649234737806.js";import"./Enum.1649234737806.js";const oe=T({name:"RoleEdit",props:{visible:{type:Boolean},data:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const l=q({dialogVisible:!1,form:{id:null,name:"",status:1,remark:""},btnLoading:!1});L(e,p=>{l.dialogVisible=p.visible,p.data?l.form=w({},p.data):l.form={}});const f=()=>{o("update:visible",!1),o("cancel")},h=async()=>{await(l.form.id?F.update:F.save).request(l.form),o("val-change",l.form),f(),l.btnLoading=!0,setTimeout(()=>{l.btnLoading=!1},1e3)};return $(w({},A(l)),{btnOk:h,cancel:f})}}),le={class:"role-dialog"},se={class:"dialog-footer"},te=y("\u786E \u5B9A"),ue=y("\u53D6 \u6D88");function re(e,o,l,f,h,p){const n=i("el-input"),m=i("el-form-item"),d=i("el-form"),t=i("el-button"),c=i("el-dialog");return b(),C("div",le,[s(c,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[3]||(o[3]=g=>e.dialogVisible=g),"show-close":!1,"before-close":e.cancel,width:"500px"},{footer:a(()=>[k("div",se,[s(t,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:a(()=>[te]),_:1},8,["loading","onClick"]),s(t,{onClick:o[2]||(o[2]=g=>e.cancel())},{default:a(()=>[ue]),_:1})])]),default:a(()=>[s(d,{model:e.form,"label-width":"90px"},{default:a(()=>[s(m,{label:"\u89D2\u8272\u540D\u79F0:",required:""},{default:a(()=>[s(n,{modelValue:e.form.name,"onUpdate:modelValue":o[0]||(o[0]=g=>e.form.name=g),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),s(m,{label:"\u89D2\u8272\u63CF\u8FF0:"},{default:a(()=>[s(n,{modelValue:e.form.remark,"onUpdate:modelValue":o[1]||(o[1]=g=>e.form.remark=g),type:"textarea",rows:3,placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u63CF\u8FF0"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue","before-close"])])}var ae=U(oe,[["render",re]]);const ne=T({name:"ResourceEdit",props:{visible:{type:Boolean},title:{type:String},role:{type:Object},defaultCheckedKeys:{type:Array},resources:{type:Array}},setup(e,{emit:o}){const l=X(null),f=q({dialogVisible:!1,defaultProps:{children:"children",label:"name"}});L(()=>e.visible,d=>{f.dialogVisible=d});const h=d=>{let t=[];for(let c of d)p(c,t);return t},p=(d,t)=>{if(d.children!==null)for(let c of d.children)p(c,t);else t.push(d.id)},n=async()=>{let d=l.value.getCheckedKeys(),t=l.value.getHalfCheckedKeys(),c=[].concat(d,t).join(",");await F.saveResources.request({id:e.role.id,resourceIds:c}),S.success("\u4FDD\u5B58\u6210\u529F!"),o("cancel")},m=()=>{o("update:visible",!1),setTimeout(()=>{o("cancel")},700)};return $(w({},A(f)),{enums:z,menuTree:l,btnOk:n,getAllLeafIds:h,cancel:m})}}),ie={class:"custom-tree-node"},de={key:0},ce={key:1,style:{color:"#67c23a"}},pe={class:"dialog-footer"},fe=y("\u786E \u5B9A"),me=y("\u53D6 \u6D88");function ge(e,o,l,f,h,p){const n=i("el-tree"),m=i("el-button"),d=i("el-dialog");return b(),C("div",null,[s(d,{title:"\u5206\u914D\u201C"+e.role.name+"\u201D\u83DC\u5355&\u6743\u9650",modelValue:e.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=t=>e.dialogVisible=t),"before-close":e.cancel,"show-close":!1,width:"400px"},{footer:a(()=>[k("div",pe,[s(m,{type:"primary",onClick:e.btnOk},{default:a(()=>[fe]),_:1},8,["onClick"]),s(m,{onClick:e.cancel},{default:a(()=>[me]),_:1},8,["onClick"])])]),default:a(()=>[s(n,{style:{height:"50vh",overflow:"auto"},ref:"menuTree",data:e.resources,"show-checkbox":"","node-key":"id","default-checked-keys":e.defaultCheckedKeys,props:e.defaultProps},{default:a(({node:t,data:c})=>[k("span",ie,[c.type==e.enums.ResourceTypeEnum.MENU.value?(b(),C("span",de,_(t.label),1)):B("",!0),c.type==e.enums.ResourceTypeEnum.PERMISSION.value?(b(),C("span",ce,_(t.label),1)):B("",!0)])]),_:1},8,["data","default-checked-keys","props"])]),_:1},8,["title","modelValue","before-close"])])}var be=U(ne,[["render",ge]]);const he=T({name:"ShowResource",props:{visible:{type:Boolean},resources:{type:Array},title:{type:String}},setup(e,{emit:o}){const{proxy:l}=Y(),f=q({dialogVisible:!1,defaultProps:{children:"children",label:"resourceName"}});L(()=>e.visible,n=>{f.dialogVisible=n});const h=n=>{O.alert('<strong style="margin-right: 18px">\u8D44\u6E90\u540D\u79F0:</strong>'+n.resourceName+' <br/><strong style="margin-right: 18px">\u5206\u914D\u8D26\u53F7:</strong>'+n.creator+' <br/><strong style="margin-right: 18px">\u5206\u914D\u65F6\u95F4:</strong>'+l.$filters.dateFormat(n.createTime),"\u5206\u914D\u4FE1\u606F",{type:"info",dangerouslyUseHTMLString:!0,closeOnClickModal:!0,showConfirmButton:!1}).catch(()=>{})},p=()=>{o("update:visible",!1),o("update:resources",[])};return $(w({},A(f)),{enums:z,info:h,closeDialog:p})}}),ye={class:"custom-tree-node"},ve={key:0},De={key:1,style:{color:"#67c23a"}};function Ce(e,o,l,f,h,p){const n=i("el-link"),m=i("el-tree"),d=i("el-dialog");return b(),C("div",null,[s(d,{onClose:e.closeDialog,title:e.title,"before-close":e.closeDialog,modelValue:e.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=t=>e.dialogVisible=t),width:"400px"},{default:a(()=>[s(m,{style:{height:"50vh",overflow:"auto"},data:e.resources,"node-key":"id",props:e.defaultProps,"expand-on-click-node":!1},{default:a(({node:t,data:c})=>[k("span",ye,[c.type==e.enums.ResourceTypeEnum.MENU.value?(b(),C("span",ve,_(t.label),1)):B("",!0),c.type==e.enums.ResourceTypeEnum.PERMISSION.value?(b(),C("span",De,_(t.label),1)):B("",!0),s(n,{onClick:j(g=>e.info(c),["prevent"]),style:{"margin-left":"25px"},icon:"el-icon-view",type:"info",underline:!1},null,8,["onClick"])])]),_:1},8,["data","props"])]),_:1},8,["onClose","title","before-close","modelValue"])])}var Fe=U(he,[["render",Ce]]);const ke=T({name:"RoleList",components:{RoleEdit:ae,ResourceEdit:be,ShowResource:Fe},setup(){const e=q({dialogFormVisible:!1,currentEditPermissions:!1,query:{pageNum:1,pageSize:10,name:null},total:0,roles:[],chooseId:null,chooseData:null,resourceDialog:{visible:!1,role:{},resources:[],defaultCheckedKeys:[]},roleEdit:{title:"\u89D2\u8272\u7F16\u8F91",visible:!1,role:{}},showResourceDialog:{visible:!1,resources:[],title:""}});Z(()=>{o()});const o=async()=>{let u=await F.list.request(e.query);e.roles=u.list,e.total=u.total},l=u=>{e.query.pageNum=u,o()},f=u=>{!u||(e.chooseId=u.id,e.chooseData=u)},h=()=>{S.success("\u4FEE\u6539\u6210\u529F\uFF01"),o()},p=u=>{u?e.roleEdit.role=u:e.roleEdit.role=!1,e.roleEdit.visible=!0},n=async u=>{try{await O.confirm(`\u6B64\u64CD\u4F5C\u5C06\u5220\u9664 [${u.name}] \u8BE5\u89D2\u8272\uFF0C\u4EE5\u53CA\u4E0E\u8BE5\u89D2\u8272\u6709\u5173\u7684\u8D26\u53F7\u89D2\u8272\u5173\u8054\u4FE1\u606F\u548C\u8D44\u6E90\u89D2\u8272\u5173\u8054\u4FE1\u606F, \u662F\u5426\u7EE7\u7EED?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await F.del.request({id:u.id}),S.success("\u5220\u9664\u6210\u529F\uFF01"),o()}catch{}},m=async u=>{e.showResourceDialog.resources=await F.roleResources.request({id:u.id}),e.showResourceDialog.title='"'+u.name+'"\u7684\u83DC\u5355&\u6743\u9650',e.showResourceDialog.visible=!0},d=()=>{e.showResourceDialog.visible=!1,e.showResourceDialog.resources=[]},t=async u=>{let v=await ee.list.request(null);e.resourceDialog.resources=v;let D=await F.roleResourceIds.request({id:u.id}),E=D||[],r=[],R=c(e.resourceDialog.resources);for(let M of R)E.includes(M)&&r.push(M);e.resourceDialog.defaultCheckedKeys=r,e.resourceDialog.visible=!0,e.resourceDialog.role=u},c=u=>{let v=[];for(let D of u)g(D,v);return v},g=(u,v)=>{if(u.children!==null)for(let D of u.children)g(D,v);else v.push(u.id)},N=()=>{e.resourceDialog.visible=!1,setTimeout(()=>{e.resourceDialog.role={},e.resourceDialog.defaultCheckedKeys=[]},10)};return $(w({},A(e)),{search:o,handlePageChange:l,choose:f,roleEditChange:h,editRole:p,deleteRole:n,showResources:m,closeShowResourceDialog:d,editResource:t,cancelEditResources:N})}}),Ee={class:"role-list"},we={class:"toolbar"},_e=y("\u6DFB\u52A0"),$e=y("\u7F16\u8F91"),Re=y("\u5206\u914D\u83DC\u5355&\u6743\u9650"),Ve=y("\u5220\u9664"),Ie={style:{float:"right"}},Be=k("i",null,null,-1),Te=y("\u83DC\u5355&\u6743\u9650");function qe(e,o,l,f,h,p){const n=i("el-button"),m=i("el-input"),d=i("el-radio"),t=i("el-table-column"),c=i("el-link"),g=i("el-table"),N=i("el-pagination"),u=i("role-edit"),v=i("resource-edit"),D=i("show-resource"),E=x("auth");return b(),C("div",Ee,[k("div",we,[V((b(),I(n,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=r=>e.editRole(!1))},{default:a(()=>[_e]),_:1})),[[E,"role:add"]]),V((b(),I(n,{disabled:e.chooseId==null,onClick:o[1]||(o[1]=r=>e.editRole(e.chooseData)),type:"primary",icon:"edit"},{default:a(()=>[$e]),_:1},8,["disabled"])),[[E,"role:update"]]),V((b(),I(n,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=r=>e.editResource(e.chooseData)),type:"success",icon:"setting"},{default:a(()=>[Re]),_:1},8,["disabled"])),[[E,"role:saveResources"]]),V((b(),I(n,{disabled:e.chooseId==null,onClick:o[3]||(o[3]=r=>e.deleteRole(e.chooseData)),type:"danger",icon:"delete"},{default:a(()=>[Ve]),_:1},8,["disabled"])),[[E,"role:del"]]),k("div",Ie,[s(m,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0\uFF01",style:{width:"140px"},modelValue:e.query.name,"onUpdate:modelValue":o[4]||(o[4]=r=>e.query.name=r),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),s(n,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),s(g,{data:e.roles,onCurrentChange:e.choose,border:"",ref:"table",style:{width:"100%"}},{default:a(()=>[s(t,{label:"\u9009\u62E9",width:"50px"},{default:a(r=>[s(d,{modelValue:e.chooseId,"onUpdate:modelValue":o[5]||(o[5]=R=>e.chooseId=R),label:r.row.id},{default:a(()=>[Be]),_:2},1032,["modelValue","label"])]),_:1}),s(t,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),s(t,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),s(t,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:a(r=>[y(_(e.$filters.dateFormat(r.row.createTime)),1)]),_:1}),s(t,{prop:"updateTime",label:"\u4FEE\u6539\u65F6\u95F4"},{default:a(r=>[y(_(e.$filters.dateFormat(r.row.updateTime)),1)]),_:1}),s(t,{label:"\u67E5\u770B\u66F4\u591A","min-width":"80px"},{default:a(r=>[s(c,{onClick:j(R=>e.showResources(r.row),["prevent"]),type:"info"},{default:a(()=>[Te]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),s(N,{onCurrentChange:e.handlePageChange,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[6]||(o[6]=r=>e.query.pageNum=r),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),s(u,{title:e.roleEdit.title,visible:e.roleEdit.visible,"onUpdate:visible":o[7]||(o[7]=r=>e.roleEdit.visible=r),data:e.roleEdit.role,onValChange:e.roleEditChange},null,8,["title","visible","data","onValChange"]),s(v,{visible:e.resourceDialog.visible,"onUpdate:visible":o[8]||(o[8]=r=>e.resourceDialog.visible=r),role:e.resourceDialog.role,resources:e.resourceDialog.resources,defaultCheckedKeys:e.resourceDialog.defaultCheckedKeys,onCancel:o[9]||(o[9]=r=>e.cancelEditResources())},null,8,["visible","role","resources","defaultCheckedKeys"]),s(D,{visible:e.showResourceDialog.visible,"onUpdate:visible":o[10]||(o[10]=r=>e.showResourceDialog.visible=r),title:e.showResourceDialog.title,resources:e.showResourceDialog.resources,"onUpdate:resources":o[11]||(o[11]=r=>e.showResourceDialog.resources=r)},null,8,["visible","title","resources"])])}var Ke=U(ke,[["render",qe]]);export{Ke as default};
